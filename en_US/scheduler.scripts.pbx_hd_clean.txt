scheduler.scripts.pbx_hd_clean = Free disk space
scheduler.scripts.pbx_hd_clean.description = <p>usage: pbx_hd_clean [-h] [-t THRESHOLD] [-T THRESHOLD_TARGET] [-a ASTLOGS_RATE] [-b BACKUPS_RATE] [-r RECORDINGS_RATE] [-l LOG_MAX_SIZE] [-n BACKUPS_NUM] [--modules MODULES] [-v] [-d] [-s] [--list] [--html-usage] [--html-usage-raw]</p><p>This script ensures that there is minimal sufficient free hard disk space for proper PBX behavior. It checks the available disk space and if it is lower than configurable threshold value then the script will free disk space by deleting files on the main partition.</p><p> The script checks the proportion (rate) of disk space taken by different classes of files: call recordings, log files, backups etc and then deletes the oldest files accordingly.</p><p> It will only attempt at cleaning if the disk usage in the main partition is above the threshold (by default: 0.95). It will generally attempt cleaning up files until it goes below the target threshold (by default: 0.9).</p></ul><p>optional arguments</p><ul><li> -h, --help show this help message and exit</li><li> -t THRESHOLD, --threshold THRESHOLD Rate of used space at which we start cleaning. Default: 0.95.</li><li> -T THRESHOLD_TARGET, --threshold-target THRESHOLD_TARGET Rate of used space at which we stop cleaning. Default: 0.9.</li><li> -a ASTLOGS_RATE, --astlogs-rate ASTLOGS_RATE Maximal part of free disk space used for Asterisk logs. Default: 0.05</li><li> -b BACKUPS_RATE, --backups-rate BACKUPS_RATE Maximal part of free disk space used for backups. Default: 0.2</li><li> -r RECORDINGS_RATE, --recordings-rate RECORDINGS_RATE Maximal part of free disk space used for recordings. Default: 0.5</li><li> -l LOG_MAX_SIZE, --log-max-size LOG_MAX_SIZE Size (MB) beyond which log file may be deleted. Default: 10 (MB)</li><li> -n BACKUPS_NUM, --backups-num BACKUPS_NUM Number of backups to always avoid delete. Default: 2</li><li> --modules MODULES Comma-separates list of cleaner modules. Default: (all modules)</li><li> -v, --verbose Be verbose</li></ul><p>For Interactive Use</p><ul><li> -d, --no-act Do nothing. Just print what is to be run</li><li> -s, --status Do nothing. Just show status</li><li> --list Do nothing. Just list cleaner modules</li><li> --html-usage Do nothing. Format help as HTML (a single line)</li><li> --html-usage-raw If html-usage: don't squash HTML to a single line</li></ul><p>Defaults should work fine. The defaults are set to be safe for systems with smaller disks. On larger ones the sum of the three rates (astlogs, backups and recordings) can be much closer to 1. For example: --backups-rate 0.7 . If your backups include recordings, change their rates accordingly. For example: -b 0.5 -r 0.2 .</p><p> You can also run the script manually in the shell command line: /usr/share/ombutel/task-scripts/pbx_hd_clean</p>
